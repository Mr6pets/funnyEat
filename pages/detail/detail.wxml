<!--pages/detail/detail.wxml-->
<view class="detail-container">
  <!-- èœå“å›¾ç‰‡è½®æ’­ -->
  <view class="image-section">
    <swiper class="dish-swiper" indicator-dots="{{dishImages.length > 1}}" autoplay="{{dishImages.length > 1}}" interval="3000" duration="500">
      <swiper-item wx:for="{{dishImages}}" wx:key="*this">
        <image class="dish-image" src="{{item}}" mode="aspectFill" bindtap="onPreviewImage" data-url="{{item}}" />
      </swiper-item>
    </swiper>
    
    <!-- è¿”å›æŒ‰é’® -->
    <view class="back-btn" bindtap="onBack">
      <text class="back-icon">â€¹</text>
    </view>
    
    <!-- æ”¶è—æŒ‰é’® -->
    <view class="favorite-btn {{dish.isFavorite ? 'active' : ''}}" bindtap="onToggleFavorite">
      <text class="favorite-icon">{{dish.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}</text>
    </view>
  </view>

  <!-- èœå“åŸºæœ¬ä¿¡æ¯ -->
  <view class="info-section">
    <view class="dish-header">
      <text class="dish-name">{{dish.name}}</text>
      <view class="dish-rating">
        <text class="rating-text">â­ {{dish.rating}}</text>
        <text class="favorite-count">{{dish.favoriteCount}}äººæ”¶è—</text>
      </view>
    </view>
    
    <text class="dish-description">{{dish.description}}</text>
    
    <!-- æ ‡ç­¾ -->
    <view class="dish-tags">
      <text class="dish-tag" wx:for="{{dish.tags}}" wx:key="*this">{{item}}</text>
    </view>
    
    <!-- åŸºæœ¬ä¿¡æ¯ -->
    <view class="dish-meta">
      <view class="meta-item">
        <text class="meta-icon">â±ï¸</text>
        <text class="meta-label">åˆ¶ä½œæ—¶é—´</text>
        <text class="meta-value">{{dish.cookingTime}}åˆ†é’Ÿ</text>
      </view>
      <view class="meta-item">
        <text class="meta-icon">ğŸ“Š</text>
        <text class="meta-label">éš¾åº¦ç­‰çº§</text>
        <text class="meta-value">{{dish.difficulty}}</text>
      </view>
      <view class="meta-item">
        <text class="meta-icon">ğŸ”¥</text>
        <text class="meta-label">çƒ­é‡</text>
        <text class="meta-value">{{dish.calories}}å¡</text>
      </view>
    </view>
  </view>

  <!-- è¥å…»ä¿¡æ¯ -->
  <view class="nutrition-section" wx:if="{{dish.nutrition}}">
    <view class="section-header">
      <text class="section-title">è¥å…»ä¿¡æ¯</text>
      <text class="section-subtitle">æ¯100gå«é‡</text>
    </view>
    
    <view class="nutrition-grid">
      <view class="nutrition-item">
        <text class="nutrition-value">{{dish.nutrition.protein}}g</text>
        <text class="nutrition-label">è›‹ç™½è´¨</text>
      </view>
      <view class="nutrition-item">
        <text class="nutrition-value">{{dish.nutrition.carbs}}g</text>
        <text class="nutrition-label">ç¢³æ°´åŒ–åˆç‰©</text>
      </view>
      <view class="nutrition-item">
        <text class="nutrition-value">{{dish.nutrition.fat}}g</text>
        <text class="nutrition-label">è„‚è‚ª</text>
      </view>
      <view class="nutrition-item">
        <text class="nutrition-value">{{dish.nutrition.fiber}}g</text>
        <text class="nutrition-label">è†³é£Ÿçº¤ç»´</text>
      </view>
    </view>
    
    <view class="suitable-for">
      <text class="suitable-label">é€‚å®œäººç¾¤ï¼š</text>
      <text class="suitable-text">{{dish.nutrition.suitableFor}}</text>
    </view>
  </view>

  <!-- æ‰€éœ€é£Ÿæ -->
  <view class="ingredients-section" wx:if="{{dish.ingredients && dish.ingredients.length > 0}}">
    <view class="section-header">
      <text class="section-title">æ‰€éœ€é£Ÿæ</text>
      <text class="section-subtitle">{{dish.ingredients.length}}ç§é£Ÿæ</text>
    </view>
    
    <view class="ingredients-list">
      <view class="ingredient-item" wx:for="{{dish.ingredients}}" wx:key="*this">
        <text class="ingredient-dot">â€¢</text>
        <text class="ingredient-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- åˆ¶ä½œæ­¥éª¤ -->
  <view class="steps-section" wx:if="{{dish.steps && dish.steps.length > 0}}">
    <view class="section-header">
      <text class="section-title">åˆ¶ä½œæ­¥éª¤</text>
      <text class="section-subtitle">{{dish.steps.length}}ä¸ªæ­¥éª¤</text>
    </view>
    
    <view class="steps-list">
      <view class="step-item" wx:for="{{dish.steps}}" wx:key="*this">
        <view class="step-number">{{index + 1}}</view>
        <text class="step-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- å°è´´å£« -->
  <view class="tips-section">
    <view class="section-header">
      <text class="section-title">åˆ¶ä½œå°è´´å£«</text>
    </view>
    
    <view class="tips-list">
      <view class="tip-item">
        <text class="tip-icon">ğŸ’¡</text>
        <text class="tip-text">é£Ÿææ–°é²œåº¦ç›´æ¥å½±å“èœå“å£æ„Ÿï¼Œå»ºè®®é€‰æ‹©å½“å­£é£Ÿæ</text>
      </view>
      <view class="tip-item">
        <text class="tip-icon">ğŸ”¥</text>
        <text class="tip-text">æŒæ¡å¥½ç«å€™æ˜¯å…³é”®ï¼Œå¤§ç«çˆ†ç‚’ï¼Œå°ç«æ…¢ç‚–</text>
      </view>
      <view class="tip-item">
        <text class="tip-icon">â°</text>
        <text class="tip-text">æå‰å‡†å¤‡æ‰€æœ‰é£Ÿæå’Œè°ƒæ–™ï¼Œåˆ¶ä½œè¿‡ç¨‹æ›´é¡ºç•…</text>
      </view>
    </view>
  </view>

  <!-- ç›¸å…³æ¨è -->
  <view class="related-section" wx:if="{{relatedDishes.length > 0}}">
    <view class="section-header">
      <text class="section-title">ç›¸å…³æ¨è</text>
      <text class="section-subtitle">ä½ å¯èƒ½è¿˜å–œæ¬¢</text>
    </view>
    
    <scroll-view class="related-scroll" scroll-x="true" show-scrollbar="false">
      <view class="related-list">
        <view 
          class="related-item" 
          wx:for="{{relatedDishes}}" 
          wx:key="id"
          bindtap="onRelatedTap"
          data-dish="{{item}}"
        >
          <image class="related-image" src="{{item.imageUrl}}" mode="aspectFill" />
          <view class="related-info">
            <text class="related-name">{{item.name}}</text>
            <text class="related-time">â±ï¸ {{item.cookingTime}}åˆ†é’Ÿ</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="action-btn action-btn-secondary" bindtap="onAddToHistory">
      <text class="action-btn-icon">ğŸ“</text>
      <text>åŠ å…¥å†å²</text>
    </button>
    <button class="action-btn action-btn-primary" bindtap="onStartCooking">
      <text class="action-btn-icon">ğŸ‘¨â€ğŸ³</text>
      <text>å¼€å§‹åˆ¶ä½œ</text>
    </button>
  </view>
</view>

<!-- å›¾ç‰‡é¢„è§ˆé®ç½© -->
<view class="preview-overlay {{showPreview ? 'show' : ''}}" bindtap="onClosePreview">
  <image class="preview-image" src="{{previewUrl}}" mode="aspectFit" />
</view>

<!-- åˆ¶ä½œç¡®è®¤å¼¹çª— -->
<view class="modal-overlay {{showCookingModal ? 'show' : ''}}" bindtap="onCloseCookingModal">
  <view class="cooking-modal" catchtap="stopPropagation">
    <view class="cooking-header">
      <text class="cooking-title">å¼€å§‹åˆ¶ä½œ</text>
      <text class="cooking-close" bindtap="onCloseCookingModal">Ã—</text>
    </view>
    <view class="cooking-content">
      <text class="cooking-text">å‡†å¤‡å¥½å¼€å§‹åˆ¶ä½œã€Š{{dish.name}}ã€‹äº†å—ï¼Ÿ</text>
      <text class="cooking-subtitle">é¢„è®¡ç”¨æ—¶ï¼š{{dish.cookingTime}}åˆ†é’Ÿ</text>
    </view>
    <view class="cooking-actions">
      <button class="cooking-btn cooking-btn-secondary" bindtap="onCloseCookingModal">ç¨ååˆ¶ä½œ</button>
      <button class="cooking-btn cooking-btn-primary" bindtap="onConfirmCooking">å¼€å§‹åˆ¶ä½œ</button>
    </view>
  </view>
</view>