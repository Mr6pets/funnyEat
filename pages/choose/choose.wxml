<!--pages/choose/choose.wxml-->
<view class="choose-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">{{pageTitle || 'é€‰æ‹©èœå“'}}</text>
    <text class="page-subtitle">{{pageSubtitle || 'æ ¹æ®ä½ çš„å–œå¥½æ¨è'}}</text>
  </view>

  <!-- ç­›é€‰æ¡ä»¶ -->
  <view class="filter-section">
    <view class="filter-header">
      <text class="filter-title">ç­›é€‰æ¡ä»¶</text>
      <text class="filter-reset" bindtap="onResetFilters">é‡ç½®</text>
    </view>
    
    <!-- èœå“åˆ†ç±» -->
    <view class="filter-group">
      <text class="filter-label">èœå“åˆ†ç±»</text>
      <view class="filter-tags">
        <text 
          class="filter-tag {{filters.category === item.id ? 'active' : ''}}" 
          wx:for="{{categories}}" 
          wx:key="id"
          bindtap="onFilterTap"
          data-type="category"
          data-value="{{item.id}}"
        >
          {{item.icon}} {{item.name}}
        </text>
      </view>
    </view>

    <!-- èœç³»é€‰æ‹© -->
    <view class="filter-group">
      <text class="filter-label">èœç³»</text>
      <view class="filter-tags">
        <text 
          class="filter-tag {{filters.cuisine === item.id ? 'active' : ''}}" 
          wx:for="{{cuisines}}" 
          wx:key="id"
          bindtap="onFilterTap"
          data-type="cuisine"
          data-value="{{item.id}}"
        >
          {{item.icon}} {{item.name}}
        </text>
      </view>
    </view>

    <!-- åˆ¶ä½œéš¾åº¦ -->
    <view class="filter-group">
      <text class="filter-label">åˆ¶ä½œéš¾åº¦</text>
      <view class="filter-tags">
        <text 
          class="filter-tag {{filters.difficulty === item.id ? 'active' : ''}}" 
          wx:for="{{difficultyOptions}}" 
          wx:key="id"
          bindtap="onFilterTap"
          data-type="difficulty"
          data-value="{{item.id}}"
        >
          {{item.name}}
        </text>
      </view>
    </view>

    <!-- åˆ¶ä½œæ—¶é—´ -->
    <view class="filter-group">
      <text class="filter-label">åˆ¶ä½œæ—¶é—´</text>
      <view class="filter-tags">
        <text 
          class="filter-tag {{filters.cookingTime === item.time ? 'active' : ''}}" 
          wx:for="{{cookingTimeOptions}}" 
          wx:key="id"
          bindtap="onFilterTap"
          data-type="cookingTime"
          data-value="{{item.time}}"
        >
          {{item.name}}
        </text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-section">
    <button 
      class="action-btn action-btn-secondary" 
      bindtap="onRandomChoice"
      disabled="{{isLoading}}"
    >
      <text class="action-btn-icon">ğŸ²</text>
      <text>éšæœºæ¨è</text>
    </button>
    <button 
      class="action-btn action-btn-primary" 
      bindtap="onFilterSearch"
      disabled="{{isLoading}}"
    >
      <text class="action-btn-icon">ğŸ”</text>
      <text>ç­›é€‰æœç´¢</text>
    </button>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view class="results-section" wx:if="{{searchResults.length > 0 || isLoading}}">
    <view class="results-header">
      <text class="results-title">æœç´¢ç»“æœ</text>
      <text class="results-count">å…±{{searchResults.length}}é“èœ</text>
    </view>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-container" wx:if="{{isLoading}}">
      <text class="loading-text">æ­£åœ¨æœç´¢ä¸­...</text>
    </view>
    
    <!-- ç»“æœåˆ—è¡¨ -->
    <view class="results-list" wx:else>
      <view 
        class="result-item" 
        wx:for="{{searchResults}}" 
        wx:key="id"
        bindtap="onResultTap"
        data-dish="{{item}}"
      >
        <image class="result-image" src="{{item.imageUrl}}" mode="aspectFill" />
        <view class="result-content">
          <view class="result-header">
            <text class="result-name">{{item.name}}</text>
            <view class="result-rating">
              <text class="result-rating-text">â­ {{item.rating}}</text>
            </view>
          </view>
          <text class="result-description">{{item.description}}</text>
          <view class="result-tags">
            <text class="result-tag" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
          </view>
          <view class="result-meta">
            <text class="result-meta-item">â±ï¸ {{item.cookingTime}}åˆ†é’Ÿ</text>
            <text class="result-meta-item">ğŸ”¥ {{item.calories}}å¡</text>
            <text class="result-meta-item">ğŸ“Š {{item.difficulty}}</text>
          </view>
        </view>
        <view class="result-actions">
          <text class="result-favorite {{item.isFavorite ? 'active' : ''}}" 
                bindtap="onToggleFavorite" 
                data-dish-id="{{item.id}}"
                catchtap="stopPropagation">
            {{item.isFavorite ? 'â¤ï¸' : 'ğŸ¤'}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{showEmpty}}">
    <text class="empty-icon">ğŸ½ï¸</text>
    <text class="empty-title">æš‚æ— ç¬¦åˆæ¡ä»¶çš„èœå“</text>
    <text class="empty-subtitle">è¯•è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–éšæœºæ¨è</text>
    <button class="empty-btn" bindtap="onRandomChoice">éšæœºæ¨è</button>
  </view>

  <!-- æ¨èæç¤º -->
  <view class="tips-section" wx:if="{{searchResults.length === 0 && !isLoading}}">
    <view class="tip-item">
      <text class="tip-icon">ğŸ’¡</text>
      <text class="tip-text">ä¸çŸ¥é“é€‰ä»€ä¹ˆï¼Ÿè¯•è¯•éšæœºæ¨èåŠŸèƒ½</text>
    </view>
    <view class="tip-item">
      <text class="tip-icon">ğŸ¯</text>
      <text class="tip-text">è®¾ç½®ç­›é€‰æ¡ä»¶ï¼Œæ‰¾åˆ°æœ€é€‚åˆçš„èœå“</text>
    </view>
    <view class="tip-item">
      <text class="tip-icon">â­</text>
      <text class="tip-text">æ”¶è—å–œæ¬¢çš„èœå“ï¼Œä¸‹æ¬¡æ›´å®¹æ˜“æ‰¾åˆ°</text>
    </view>
  </view>
</view>

<!-- éšæœºç»“æœå¼¹çª— -->
<view class="modal-overlay {{showRandomResult ? 'show' : ''}}" bindtap="onCloseRandomResult">
  <view class="random-modal" catchtap="stopPropagation">
    <view class="random-header">
      <text class="random-title">éšæœºæ¨è</text>
      <text class="random-close" bindtap="onCloseRandomResult">Ã—</text>
    </view>
    <view class="random-content" wx:if="{{randomDish}}">
      <image class="random-image" src="{{randomDish.imageUrl}}" mode="aspectFill" />
      <view class="random-info">
        <text class="random-dish-name">{{randomDish.name}}</text>
        <text class="random-dish-desc">{{randomDish.description}}</text>
        <view class="random-tags">
          <text class="random-tag" wx:for="{{randomDish.tags}}" wx:key="*this">{{item}}</text>
        </view>
        <view class="random-meta">
          <text class="random-meta-item">â±ï¸ {{randomDish.cookingTime}}åˆ†é’Ÿ</text>
          <text class="random-meta-item">ğŸ”¥ {{randomDish.calories}}å¡</text>
          <text class="random-meta-item">â­ {{randomDish.rating}}</text>
        </view>
      </view>
    </view>
    <view class="random-actions">
      <button class="random-btn random-btn-secondary" bindtap="onRandomChoice">å†æ¥ä¸€æ¬¡</button>
      <button class="random-btn random-btn-primary" bindtap="onViewRandomDetail">æŸ¥çœ‹è¯¦æƒ…</button>
    </view>
  </view>
</view>