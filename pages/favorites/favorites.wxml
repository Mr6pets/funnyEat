<!--pages/favorites/favorites.wxml-->
<view class="favorites-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">æˆ‘çš„æ”¶è—</text>
    <text class="page-subtitle">{{favoritesList.length}}é“æ”¶è—èœå“</text>
  </view>

  <!-- æ“ä½œæ  -->
  <view class="action-bar" wx:if="{{favoritesList.length > 0}}">
    <view class="sort-tabs">
      <text 
        class="sort-tab {{currentSort === 'time' ? 'active' : ''}}" 
        bindtap="onSortTap" 
        data-sort="time"
      >
        æŒ‰æ—¶é—´
      </text>
      <text 
        class="sort-tab {{currentSort === 'name' ? 'active' : ''}}" 
        bindtap="onSortTap" 
        data-sort="name"
      >
        æŒ‰åç§°
      </text>
      <text 
        class="sort-tab {{currentSort === 'rating' ? 'active' : ''}}" 
        bindtap="onSortTap" 
        data-sort="rating"
      >
        æŒ‰è¯„åˆ†
      </text>
    </view>
    <text class="manage-btn" bindtap="onToggleManage">{{isManaging ? 'å®Œæˆ' : 'ç®¡ç†'}}</text>
  </view>

  <!-- æ”¶è—åˆ—è¡¨ -->
  <view class="favorites-list" wx:if="{{sortedList.length > 0}}">
    <view 
      class="favorite-item {{isManaging ? 'managing' : ''}}" 
      wx:for="{{sortedList}}" 
      wx:key="id"
      bindtap="onFavoriteTap"
      data-item="{{item}}"
    >
      <!-- é€‰æ‹©æ¡† -->
      <view class="select-box {{item.selected ? 'selected' : ''}}" wx:if="{{isManaging}}" 
            bindtap="onSelectItem" data-item-id="{{item.id}}" catchtap="stopPropagation">
        <text class="select-icon">{{item.selected ? 'âœ“' : ''}}</text>
      </view>
      
      <image class="favorite-image" src="{{item.dish.imageUrl}}" mode="aspectFill" />
      <view class="favorite-content">
        <view class="favorite-header">
          <text class="favorite-name">{{item.dish.name}}</text>
          <view class="favorite-rating">
            <text class="rating-text">â­ {{item.dish.rating}}</text>
          </view>
        </view>
        <text class="favorite-desc">{{item.dish.description}}</text>
        <view class="favorite-tags">
          <text class="favorite-tag" wx:for="{{item.dish.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
        </view>
        <view class="favorite-meta">
          <text class="favorite-meta-item">â±ï¸ {{item.dish.cookingTime}}åˆ†é’Ÿ</text>
          <text class="favorite-meta-item">ğŸ”¥ {{item.dish.calories}}å¡</text>
          <text class="favorite-meta-item">æ”¶è—äº {{item.timeText}}</text>
        </view>
      </view>
      <view class="favorite-actions" wx:if="{{!isManaging}}">
        <text 
          class="favorite-remove" 
          bindtap="onRemoveFavorite" 
          data-item-id="{{item.id}}"
          catchtap="stopPropagation"
        >
          ğŸ’”
        </text>
      </view>
    </view>
  </view>

  <!-- æ‰¹é‡æ“ä½œæ  -->
  <view class="batch-actions" wx:if="{{isManaging && favoritesList.length > 0}}">
    <view class="batch-left">
      <text class="select-all" bindtap="onSelectAll">
        {{selectedCount === favoritesList.length ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}
      </text>
      <text class="selected-count">å·²é€‰æ‹© {{selectedCount}} é¡¹</text>
    </view>
    <button class="batch-delete" bindtap="onBatchDelete" disabled="{{selectedCount === 0}}">
      åˆ é™¤é€‰ä¸­
    </button>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{sortedList.length === 0 && !isLoading}}">
    <text class="empty-icon">ğŸ’”</text>
    <text class="empty-title">æš‚æ— æ”¶è—èœå“</text>
    <text class="empty-subtitle">å»å‘ç°ä¸€äº›ç¾å‘³çš„èœå“æ”¶è—å§</text>
    <button class="empty-btn" bindtap="onGoDiscover">å»å‘ç°</button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{isLoading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>

<!-- åˆ é™¤ç¡®è®¤å¼¹çª— -->
<view class="modal-overlay {{showDeleteModal ? 'show' : ''}}" bindtap="onCloseDeleteModal">
  <view class="delete-modal" catchtap="stopPropagation">
    <view class="delete-header">
      <text class="delete-title">{{deleteType === 'single' ? 'å–æ¶ˆæ”¶è—' : 'æ‰¹é‡åˆ é™¤'}}</text>
    </view>
    <view class="delete-content">
      <text class="delete-text" wx:if="{{deleteType === 'single'}}">
        ç¡®å®šè¦å–æ¶ˆæ”¶è—è¿™é“èœå“å—ï¼Ÿ
      </text>
      <text class="delete-text" wx:else>
        ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ {{selectedCount}} é“èœå“å—ï¼Ÿ
      </text>
    </view>
    <view class="delete-actions">
      <button class="delete-btn-secondary" bindtap="onCloseDeleteModal">å–æ¶ˆ</button>
      <button class="delete-btn-primary" bindtap="onConfirmDelete">ç¡®å®š</button>
    </view>
  </view>
</view>